# v0.3.0 发布说明

## 版本信息

- **版本号**: v0.3.0
- **发布日期**: 2025年11月26日
- **主要更新**: 禅道数据迁移工具、通用组件封装、项目详情页优化
- **基于版本**: v0.2.0

---

## 📋 版本更新概览

本版本包含从 v0.2.0 到 v0.3.0 的所有更新内容：

### v0.2.0 主要功能
- ✅ 微信账号绑定功能
- ✅ 附件管理功能
- ✅ 工作报告功能优化
- ✅ 系统初始化流程优化
- ✅ 权限管理优化

### v0.3.0 新增功能
- ✅ 禅道数据迁移工具（支持10种数据类型迁移）
- ✅ 通用组件封装（ModuleManagement组件）
- ✅ Bug管理功能完善（确认状态、自动确认）
- ✅ 项目详情页优化（滚动、Markdown、模块管理对话框）

---

## 🎉 新功能（v0.2.0）

### 1. 微信账号绑定功能

允许已登录用户将自己的账号绑定到微信，绑定后可以使用微信扫码登录。

**功能特性**：
- ✅ 获取微信绑定二维码（支持PC端扫码）
- ✅ 微信绑定回调处理（自动识别用户身份）
- ✅ 微信解绑功能
- ✅ WebSocket实时通知绑定状态
- ✅ 绑定状态显示（用户信息页面）

**使用场景**：
- 用户首次登录后，可以绑定微信账号
- 绑定后可以使用微信扫码快速登录
- 支持解绑和重新绑定

**API接口**：
- `GET /api/auth/wechat/bind/qrcode` - 获取绑定二维码
- `GET /api/auth/wechat/bind/callback` - 处理绑定回调
- `POST /api/auth/wechat/unbind` - 解绑微信

### 2. 附件管理功能

支持文件上传、下载和关联实体（需求、Bug、任务等）。

**功能特性**：
- ✅ 文件上传（支持多种文件类型）
- ✅ 文件下载
- ✅ 附件关联实体（需求、Bug、任务等）
- ✅ 附件列表管理
- ✅ 文件存储管理

**使用场景**：
- 在需求、Bug、任务中上传相关文档
- 管理项目相关文件
- 下载和查看附件

### 3. 工作报告功能优化

优化日报和周报功能，提升用户体验。

**功能特性**：
- ✅ 工作内容支持Markdown渲染
- ✅ 工作内容限制2行显示（列表页）
- ✅ 提交按钮改为"提交"并自动设置状态为已提交
- ✅ 工作汇总包含用户创建的Bug
- ✅ 优化审批流程和状态显示

**改进点**：
- 工作内容展示更美观（Markdown渲染）
- 审批流程更清晰（显示所有审批人状态）
- 工作汇总更全面（包含Bug信息）

---

## 🎉 新功能（v0.3.0）

### 4. 禅道数据迁移工具

提供了完整的从禅道（Zentao）到本系统的数据迁移工具，支持迁移以下数据类型：

**支持迁移的数据类型**：
- ✅ 部门（zt_dept -> departments）- 支持树形结构迁移
- ✅ 角色和权限（zt_group + zt_grouppriv -> roles + permissions）- 支持admin账号角色分配
- ✅ 用户（zt_user -> users）
- ✅ 项目（zt_project -> projects）
- ✅ 项目模块（zt_module -> modules）
- ✅ 版本（zt_build -> versions）- 支持通过产品查找项目
- ✅ 需求（zt_story -> requirements）
- ✅ 任务（zt_task -> tasks）
- ✅ Bug（zt_bug -> bugs）
- ✅ 项目成员（zt_team -> project_members）- 使用正确的字段（root和type）

**功能特性**：
- ✅ ID映射关系维护，确保外键关联正确
- ✅ 数据去重和冲突处理
- ✅ 支持通过产品查找项目（版本迁移）
- ✅ 支持从任务、需求、Bug推断项目成员
- ✅ 支持部门树形结构迁移
- ✅ 支持admin账号角色自动分配
- ✅ 迁移完成后自动更新系统初始化状态为已完成
- ✅ 详细的迁移日志和统计信息

**使用方法**：
详细使用说明请参考 [数据迁移工具文档](../backend/cmd/migrate/README.md)

### 5. 通用组件封装

将功能模块管理封装为通用组件 `ModuleManagement`，可在项目任何地方复用。

**功能特性**：
- ✅ 支持通过 props 控制显示方式（卡片/无卡片）
- ✅ 支持自定义标题
- ✅ 提供事件通知（change、created、updated、deleted）
- ✅ 暴露方法供父组件调用（loadModules、refresh）
- ✅ 完整的 TypeScript 类型定义

**使用场景**：
- 项目列表页的模块管理对话框
- 项目详情页的模块管理对话框
- 独立的模块管理页面

### 6. Bug管理功能完善

完善了Bug管理的状态流转和确认机制。

**功能特性**：
- ✅ 添加Bug确认状态（Confirmed字段）
- ✅ 解决Bug时自动确认（当状态变为resolved且有解决方案时）
- ✅ 优化Bug操作按钮和状态选择器
- ✅ Bug状态值与禅道保持一致（active、resolved、closed）
- ✅ 支持Bug确认API（`POST /api/bugs/:id/confirm`）

**状态流转规则**：
- active -> resolved（只有active状态可以解决）
- resolved -> closed（只有resolved状态可以关闭）
- resolved/closed -> active（激活）

### 7. 项目详情页优化

优化了项目详情页的用户体验和功能。

**优化内容**：
- ✅ 修复页面滚动问题（使用flex布局和overflow-y实现内容区域滚动）
- ✅ 项目描述支持Markdown格式渲染显示
- ✅ 功能模块管理直接弹出对话框（无需跳转）
- ✅ 项目列表页"编辑"按钮改为"需求管理"
- ✅ 添加资源统计入口
- ✅ 支持URL参数自动打开编辑和成员管理对话框
- ✅ 统一项目详情页按钮样式

---

## 🔧 功能优化

### v0.2.0 功能优化

1. **系统初始化流程优化**
   - ✅ 微信配置移至系统管理菜单
   - ✅ 初始化页面直接显示微信配置表单
   - ✅ 配置完成后显示扫码登录
   - ✅ 添加微信AppID和AppSecret格式验证
   - ✅ 创建可选认证中间件，支持初始化阶段访问微信配置API
   - ✅ 优化路由守卫，系统未初始化时自动跳转到初始化页面

2. **权限管理优化**
   - ✅ 添加测试单权限（test-case:create、test-case:update、test-case:delete）
   - ✅ 优化角色权限配置
   - ✅ 项目创建者自动加入项目成员
   - ✅ 用户管理部门树形选择优化

3. **部门管理优化**
   - ✅ 优化部门树形结构显示
   - ✅ 修复重复显示问题
   - ✅ 直接使用树形数据，提升性能

4. **菜单管理优化**
   - ✅ 修复菜单排序问题
   - ✅ 创建默认角色并分配权限

### v0.3.0 功能优化

1. **列表页面布局优化**
   - ✅ 需求管理页面：添加统计和列表tab标签，修复优先级统计卡片对齐问题
   - ✅ Bug管理页面：添加统计和列表tab标签，将统计和列表分开
   - ✅ 测试单管理页面：添加统计和列表tab标签，将统计和列表分开
   - ✅ 优化列表页面布局：禁止body和main区域滚动，仅表格内容滚动

2. **页面滚动优化**
   - ✅ 项目详情页：修复页面无法滚动的问题（使用flex布局和overflow-y）
   - ✅ 工作台我的项目列表：添加滚动条支持，修复水平滚动条闪烁问题
   - ✅ 权限管理页面：优化滚动条显示，隐藏内容区域和表格滚动条，保持滚动功能
   - ✅ 资源统计界面：添加滚动支持

3. **甘特图优化**
   - ✅ 修复任务时间条显示问题：支持根据进度和预估工时自动计算结束日期
   - ✅ 优化甘特图滚动条和进度条显示
   - ✅ 修复任务进度更新和状态选择器

4. **分页查询优化**
   - ✅ 修复分页查询问题：确保总数计算应用所有筛选条件
   - ✅ 修复Bug列表分页问题：后端同时支持size和page_size参数
   - ✅ 修复权限管理列表分页：添加分页控件和表格滚动高度，确保分页控件在视口内可见

5. **状态值同步**
   - ✅ 将项目、需求、任务、Bug、测试单、版本的状态值与禅道保持一致
   - ✅ 确保状态流转符合禅道规则

6. **其他优化**
   - ✅ 优化Bug分配人筛选逻辑
   - ✅ 优化搜索字段项目选择
   - ✅ 修复资源统计页重复按钮

---

## 📝 技术改进

### v0.2.0 技术改进

**后端**：
- ✅ 微信绑定回调流程重构
- ✅ 附件上传功能实现
- ✅ 工作报告API优化
- ✅ 数据库迁移优化

**前端**：
- ✅ 微信绑定UI组件（WeChatQRCode组件）
- ✅ 附件管理页面
- ✅ 工作报告页面优化（Markdown渲染）
- ✅ 系统初始化流程优化

### v0.3.0 技术改进

**后端**：
- ✅ 禅道数据迁移工具实现（支持MySQL到SQLite/MySQL迁移）
- ✅ Bug管理功能完善（确认状态、自动确认逻辑）
- ✅ 状态值同步（与禅道保持一致）
- ✅ 分页查询优化（确保总数计算应用所有筛选条件）
- ✅ 资源分配API优化
- ✅ 项目成员迁移逻辑优化（使用正确的zt_team表字段）

**前端**：
- ✅ 通用组件封装（ModuleManagement组件），提高代码复用性
- ✅ 统一的事件通知机制
- ✅ 完善的TypeScript类型定义
- ✅ 列表页面tab标签化（需求、Bug、测试单管理页面）
- ✅ 页面滚动优化（flex布局和overflow-y）
- ✅ 甘特图功能增强（任务时间条、进度条、滚动条优化）
- ✅ Markdown内容渲染优化
- ✅ 交互流程优化（减少页面跳转，对话框模式）

---

## 🐛 问题修复

1. ✅ 修复项目详情页无法滚动的问题
2. ✅ 修复TypeScript编译错误（ModuleManagement组件、类型不匹配、未使用变量警告）
3. ✅ 修复VersionDetail.vue中缺少逗号的语法错误
4. ✅ 修复甘特图任务时间条显示问题
5. ✅ 修复工作台我的项目列表水平滚动条闪烁问题
6. ✅ 修复分页查询问题（总数计算未应用筛选条件）
7. ✅ 修复Bug列表分页参数问题（后端同时支持size和page_size）
8. ✅ 修复权限管理列表分页控件不可见问题
9. ✅ 修复项目成员迁移使用错误字段的问题
10. ✅ 修复部署问题和微信登录错误
11. ✅ 修复资源统计页重复按钮问题

---

## 📚 文档更新

- ✅ 更新所有文档的更新日期为2025年11月26日
- ✅ 添加数据迁移工具使用文档
- ✅ 更新开发计划，记录v0.3.0新功能
- ✅ 更新数据库设计文档，添加数据迁移说明

---

## 🔄 从 v0.2.0 升级到 v0.3.0

### 升级步骤

1. **备份数据**
   ```bash
   # 备份数据库文件（如果使用SQLite）
   cp backend/data.db backend/data.db.backup
   ```

2. **更新代码**
   ```bash
   git pull origin main
   # 或
   git checkout v0.3.0
   ```

3. **重新构建**
   ```bash
   # 后端
   cd backend
   make build-linux
   
   # 前端
   cd frontend
   yarn build
   ```

4. **重启服务**
   ```bash
   # 停止旧服务
   # 启动新服务
   ./server
   ```

### 注意事项

- 数据迁移工具需要单独配置，参考 [数据迁移工具文档](../backend/cmd/migrate/README.md)
- 前端需要重新构建以包含新的组件
- 建议在测试环境先验证升级

---

## 📊 版本统计

- **新增功能**: 4个主要功能（禅道数据迁移工具、通用组件封装、Bug管理完善、项目详情页优化）
- **优化改进**: 6大类功能优化（列表页面布局、页面滚动、甘特图、分页查询、状态值同步、其他优化）
- **问题修复**: 11个问题修复
- **文档更新**: 全面更新

---

**文档版本**: v0.3.0  
**最后更新**: 2025年11月26日  
**维护者**: 开发团队

