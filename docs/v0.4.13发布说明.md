# v0.4.13 发布说明

**发布日期**: 2025年12月02日

## 版本概述

v0.4.13 版本主要包含Bug功能优化、日志管理增强、Markdown预览改进等多项功能更新和问题修复。

## 主要更新

### 1. Bug功能优化 🐛

#### Bug解决自动指派
- **自动指派逻辑**：工程师点击"解决"后，如果当前没有分配人，优先指回给最后一个被分配的用户（测试员），否则指派给Bug创建者
- **历史记录查询**：从Bug操作历史中查找最后一个被分配的用户，确保工作流程顺畅

#### Bug编辑功能修复
- **修复清空关联需求/模块不生效的问题**：现在可以正确清空并保存
- **修复字段更新冲突**：解决了在更新实际工时时，关联需求、关联模块等字段的修改被覆盖的问题
- **完善历史记录显示**：所有字段修改都正确记录，显示格式优化

#### 界面优化
- **修复模态框层级问题**：解决对话框不再被详情模态框遮挡（z-index优化）
- **修复版本列表加载**：解决对话框的版本下拉框正常加载

### 2. 日志管理功能 📋

#### 日志输出到文件
- **文件日志支持**：日志自动输出到文件，支持ZIP压缩
- **自动轮转**：日志文件达到100MB时自动轮转，保留7天历史
- **前端控制**：管理员可在前端控制日志级别和下载日志文件

### 3. Markdown预览增强 📸

#### 图片预览功能
- **点击预览**：Markdown中的图片支持点击预览，弹出全屏预览窗口
- **滚动缩放**：在预览窗口中，鼠标滚轮可以放大/缩小图片（50%-500%）
- **预览标签页支持**：编辑模式的预览标签页和只读模式都支持图片点击预览

## 技术细节

### 前端修改
- `frontend/src/views/bug/Bug.vue`、`BugDetail.vue`：
  - 修复模态框z-index层级问题
  - 修复版本列表加载逻辑
  - 优化解决对话框交互
- `frontend/src/components/MarkdownEditor.vue`：
  - 添加图片点击预览功能
  - 实现滚动缩放功能
  - 优化预览标签页事件绑定
- `frontend/src/api/bug.ts`：修复TypeScript类型错误

### 后端修改
- `backend/internal/api/bug.go`：
  - 实现Bug解决自动指派功能
  - 修复字段更新冲突问题
  - 添加历史记录查询辅助函数

## 修复的问题

1. ✅ 修复编辑Bug时清空关联需求/模块不生效的问题
2. ✅ 修复更新实际工时时，关联需求/模块的修改被覆盖的问题
3. ✅ 修复历史记录中某些字段变更未被记录的问题
4. ✅ 修复解决对话框被详情模态框遮挡的问题
5. ✅ 修复解决对话框版本列表加载失败的问题
6. ✅ 修复TypeScript类型错误（requirement_id和module_id的空字符串比较）

## 升级说明

### 从 v0.4.12 升级

1. **无需数据库迁移**：本次更新不涉及数据库结构变更
2. **前端更新**：需要重新构建前端，更新相关组件
3. **后端更新**：需要重新编译后端，更新相关API处理逻辑

### 注意事项

- 历史记录显示格式已优化，旧的历史记录会以新格式显示
- 清空关联需求/模块的功能现在可以正常工作
- 所有字段的修改都会正确记录到历史记录中

## 测试建议

1. **Bug编辑测试**：
   - 测试编辑Bug时清空关联需求
   - 测试编辑Bug时清空关联模块
   - 测试同时更新实际工时和关联需求/模块

2. **历史记录测试**：
   - 验证所有字段修改都被记录
   - 验证历史记录显示格式正确
   - 验证字段名称显示为中文

## 后续计划

- 继续优化历史记录功能
- 完善其他模块的字段变更记录
- 提升整体用户体验

---

**版本号**: v0.4.13  
**发布日期**: 2025年12月02日  
**兼容性**: 向后兼容 v0.4.12

