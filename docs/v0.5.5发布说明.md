# v0.5.5 发布说明

**发布日期**: 2025年12月10日

## 版本概述

v0.5.5 版本主要聚焦于代码质量提升和配置模板通用化，通过代码审查修复了测试失败问题，清理了调试代码，并优化了配置模板的通用性。同时，前端组件进行了重构优化，提升了代码可维护性。

## 主要更新

### 代码质量提升 🔧

#### 测试修复
- **修复 TestAuthHandler_RefreshToken 测试**
  - 调整错误消息断言，使其能够正确接受两种可能的错误消息
  - 提升测试的健壮性和准确性
  - 确保刷新Token功能的测试覆盖完整

- **修复 TestBugHandler_CreateBug 测试**
  - 添加缺失的必填字段 `version_ids`
  - 创建测试版本数据，确保测试用例完整
  - 修复Bug创建功能的测试覆盖

#### 代码清理
- **移除调试代码**
  - 清理 `bug.go` 中的 28 处 `fmt.Printf` 调试语句
  - 清理 `permission.go` 中的 5 处 `fmt.Printf` 调试语句
  - 清理 `department.go` 中的 2 处 `fmt.Printf` 调试语句
  - 移除未使用的 `fmt` 导入
  - 提升代码整洁度和生产环境性能

### 配置模板通用化 📝

#### 配置和文档优化
- **配置文件通用化**
  - 将 `config.yaml` 中的具体域名替换为通用占位符
  - 提高配置模板的可复用性和通用性
  - 便于不同环境部署和配置管理

- **文档更新**
  - 更新相关文档，使用占位符替代具体域名示例
  - 统一文档格式，提高可读性
  - 涉及文档：
    - 微信回调流程说明
    - 微信登录配置指南
    - 微信scope参数错误排查指南
    - 配置微信redirect_uri环境变量

### 前端组件优化 🎨

#### 附件管理组件封装
- **新增 AttachmentList 组件**
  - 封装附件列表显示逻辑
  - 支持附件上传、下载、删除操作
  - 统一附件列表的显示样式和交互

- **新增 AttachmentPreview 组件**
  - 封装附件预览功能
  - 支持图片、PDF、文本等多种文件类型预览
  - 提供统一的附件预览体验

#### 详情组件重构
- **代码复用优化**
  - 重构 `BugDetailContent.vue`，使用封装的附件组件
  - 重构 `RequirementDetailContent.vue`，减少代码重复
  - 重构 `TaskDetailContent.vue`，提升可维护性
  - 重构 `VersionDetailContent.vue`，统一组件结构
  - 重构 `Version.vue`，优化版本列表页面

- **代码减少**
  - 通过组件封装，减少代码重复
  - 提升代码可维护性和可读性
  - 统一附件管理功能的实现方式

### 后端API增强 🔌

#### 附件管理API优化
- **附件API功能增强**
  - 优化附件关联和查询逻辑
  - 提升附件管理的性能和稳定性
  - 完善附件权限检查机制

## 技术细节

### 数据库变更
- 无数据库结构变更

### API变更
- 无破坏性API变更
- 附件管理API功能增强（向后兼容）

### 涉及文件

#### 后端
- `backend/internal/api/bug.go` - 清理调试代码，优化Bug管理
- `backend/internal/api/permission.go` - 清理调试代码，移除未使用导入
- `backend/internal/api/department.go` - 清理调试代码
- `backend/internal/api/attachment.go` - 附件API功能增强
- `backend/tests/unit/auth_test.go` - 修复刷新Token测试
- `backend/tests/unit/bug_test.go` - 修复Bug创建测试
- `backend/config.yaml` - 配置模板通用化
- `backend/cmd/server/main.go` - 代码优化

#### 前端
- `frontend/src/components/AttachmentList.vue` - 附件列表组件（新增）
- `frontend/src/components/AttachmentPreview.vue` - 附件预览组件（新增）
- `frontend/src/components/BugDetailContent.vue` - Bug详情组件重构
- `frontend/src/components/RequirementDetailContent.vue` - 需求详情组件重构
- `frontend/src/components/TaskDetailContent.vue` - 任务详情组件重构
- `frontend/src/components/VersionDetailContent.vue` - 版本详情组件重构
- `frontend/src/views/version/Version.vue` - 版本列表页面优化
- `frontend/src/api/attachment.ts` - 附件API接口增强

#### 文档
- `docs/微信回调流程说明.md` - 更新域名占位符
- `docs/微信登录配置指南.md` - 更新域名占位符
- `docs/微信scope参数错误排查指南.md` - 更新域名占位符
- `docs/配置微信redirect_uri环境变量.md` - 更新域名占位符

## 升级说明

### 升级步骤
1. **更新代码**：拉取最新代码
2. **前端更新**：需要重新构建前端
   ```bash
   cd frontend
   npm install  # 如果需要更新依赖
   npm run build
   ```
3. **后端更新**：需要重新编译后端
   ```bash
   cd backend
   go build -o server cmd/server/main.go
   ```
4. **配置更新**：检查 `config.yaml` 中的域名配置，确保使用正确的域名或占位符

### 兼容性
- **向后兼容**：完全兼容 v0.5.4
- **API兼容**：所有API保持向后兼容
- **数据兼容**：无需数据迁移

### 注意事项
- 本次更新主要提升代码质量，建议所有用户升级
- 配置模板已通用化，部署时请检查配置文件中的域名设置
- 附件管理组件已重构，功能保持不变，但代码结构更清晰

## 统计信息

- **修改文件数**：21个文件
- **新增代码**：744行
- **删除代码**：593行
- **净增代码**：151行

### 代码质量提升
- **清理调试代码**：35处 `fmt.Printf` 语句
- **修复测试**：2个测试用例
- **组件封装**：2个新组件（AttachmentList、AttachmentPreview）
- **代码重构**：5个详情组件优化

---

**版本号**: v0.5.5  
**发布日期**: 2025年12月10日  
**兼容性**: 向后兼容 v0.5.4  
**建议升级**: ✅ 是（代码质量提升和配置优化）

