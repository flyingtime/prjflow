# v0.4.0 发布说明

**发布日期**: 2025年11月27日

## 版本概述

v0.4.0 版本主要聚焦于用户体验优化和操作历史追踪功能，为项目、需求、任务、Bug、版本等核心模块添加了完整的操作历史记录功能，并优化了编辑操作的交互方式。

## 主要功能

### 1. 历史记录功能 ✨

为所有核心模块的详情页面添加了完整的操作历史记录功能：

- **操作记录**：自动记录所有操作（创建、编辑、分配、解决、确认等）
- **字段变更追踪**：详细记录每个字段的变更（旧值 → 新值）
- **备注功能**：支持手动添加备注，记录重要信息
- **可折叠显示**：历史记录详情支持展开/收起，界面更简洁
- **时间线展示**：使用时间线组件展示历史记录，清晰直观

**支持的模块**：
- ✅ 项目详情页面
- ✅ 需求详情页面
- ✅ 任务详情页面
- ✅ Bug详情页面
- ✅ 版本详情页面

### 2. 编辑模态框优化 🎨

优化了所有详情页面的编辑操作体验：

- **直接编辑**：点击"编辑"按钮直接弹出编辑模态框，无需跳转页面
- **数据预填充**：编辑模态框自动填充当前数据
- **图片上传**：Markdown编辑器中的图片支持自动上传
- **实时更新**：编辑完成后自动刷新详情页面和历史记录

**优化的页面**：
- ✅ 项目详情页面
- ✅ 需求详情页面
- ✅ 任务详情页面
- ✅ Bug详情页面
- ✅ 版本详情页面

### 3. 滚动问题修复 🔧

修复了所有详情页面的滚动问题：

- **统一滚动样式**：所有详情页面使用统一的滚动样式
- **固定高度布局**：使用flex布局确保页面正确滚动
- **响应式适配**：适配不同屏幕尺寸

**修复的页面**：
- ✅ 项目详情页面
- ✅ 需求详情页面
- ✅ 任务详情页面
- ✅ Bug详情页面
- ✅ 版本详情页面

## 技术实现

### 后端

1. **历史记录数据模型**
   - `Action` 表：记录操作信息（操作类型、操作人、备注等）
   - `History` 表：记录字段变更详情（字段名、旧值、新值等）

2. **历史记录工具函数**（`backend/internal/utils/action.go`）
   - `RecordAction`：记录操作
   - `CompareAndRecord`：比较对象并记录字段变更
   - `ProcessHistory`：格式化历史记录显示

3. **API接口**
   - `GET /api/projects/:id/history` - 获取项目历史记录
   - `POST /api/projects/:id/history/note` - 添加项目备注
   - `GET /api/requirements/:id/history` - 获取需求历史记录
   - `POST /api/requirements/:id/history/note` - 添加需求备注
   - `GET /api/tasks/:id/history` - 获取任务历史记录
   - `POST /api/tasks/:id/history/note` - 添加任务备注
   - `GET /api/bugs/:id/history` - 获取Bug历史记录
   - `POST /api/bugs/:id/history/note` - 添加Bug备注

### 前端

1. **历史记录组件**
   - 使用 `a-timeline` 组件展示历史记录
   - 支持展开/收起功能
   - 字段变更详情格式化显示

2. **编辑模态框**
   - 统一的编辑表单组件
   - 数据预填充和验证
   - 图片上传集成

3. **滚动样式优化**
   - 统一的CSS样式
   - Flex布局实现
   - 响应式适配

## 使用指南

### 查看历史记录

1. 进入任意详情页面（项目、需求、任务、Bug、版本）
2. 在页面底部找到"历史记录"卡片
3. 查看操作历史，点击"展开"查看详细信息

### 添加备注

1. 在历史记录卡片标题右侧，点击"添加备注"按钮
2. 输入备注内容
3. 点击"确定"保存

### 编辑详情

1. 在详情页面顶部，点击"编辑"按钮
2. 在弹出的编辑模态框中修改信息
3. 点击"确定"保存更改

## 更新内容

### 新增文件

- `backend/internal/model/action.go` - 历史记录数据模型
- `backend/internal/utils/action.go` - 历史记录工具函数
- `docs/v0.4.0发布说明.md` - 本发布说明文档

### 修改文件

**后端**：
- `backend/cmd/server/main.go` - 添加历史记录API路由
- `backend/internal/api/project.go` - 添加项目历史记录功能
- `backend/internal/api/requirement.go` - 添加需求历史记录功能
- `backend/internal/api/task.go` - 添加任务历史记录功能
- `backend/internal/api/bug.go` - 添加Bug历史记录功能
- `backend/internal/utils/migrate.go` - 添加历史记录表迁移

**前端**：
- `frontend/src/api/project.ts` - 添加项目历史记录API
- `frontend/src/api/requirement.ts` - 添加需求历史记录API
- `frontend/src/api/task.ts` - 添加任务历史记录API
- `frontend/src/api/bug.ts` - 添加Bug历史记录API
- `frontend/src/views/project/ProjectDetail.vue` - 添加历史记录和编辑模态框
- `frontend/src/views/requirement/RequirementDetail.vue` - 添加历史记录和编辑模态框
- `frontend/src/views/task/TaskDetail.vue` - 添加历史记录和编辑模态框
- `frontend/src/views/bug/BugDetail.vue` - 优化历史记录和编辑模态框
- `frontend/src/views/version/VersionDetail.vue` - 添加编辑模态框和滚动修复

## 已知问题

无

## 后续计划

- 继续完善单元测试覆盖率
- 优化历史记录显示性能
- 添加历史记录导出功能
- 支持历史记录搜索和筛选

## 升级指南

### 从 v0.3.0 升级

1. **数据库迁移**：系统会自动创建 `actions` 和 `histories` 表
2. **前端更新**：需要重新构建前端并部署
3. **无破坏性变更**：所有现有功能保持不变

### 注意事项

- 历史记录功能会自动记录所有操作，无需额外配置
- 编辑模态框功能已集成到所有详情页面
- 滚动修复已应用到所有详情页面

## 致谢

感谢所有贡献者的支持和反馈！

---

**下载地址**: [GitHub Releases](https://github.com/funnywwh/goproject/releases/tag/v0.4.0)

