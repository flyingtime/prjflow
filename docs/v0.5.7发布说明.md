# v0.5.7 发布说明

**发布日期**: 2025年12月21日

## 版本概述

v0.5.7 版本主要聚焦于代码重构优化、UI问题修复、Docker部署支持以及项目品牌更新。通过提取可复用组件、修复弹窗遮挡问题、添加Docker支持，提升了代码质量和系统部署便利性。

## 主要更新

### 代码重构优化 🔧

#### 版本选择器组件化
- **提取 VersionSelectWithCreate 组件**
  - 创建可复用的版本选择器组件，支持单选/多选和创建新版本功能
  - 在Bug新增/编辑表单、Bug状态更新表单中使用新组件
  - 减少约100+行重复代码，提高代码可维护性
  - 统一UI和交互体验

### 问题修复 🐛

#### UI层级问题修复
- **修复需求详情转任务/转Bug弹窗被遮挡**
  - 为Modal.confirm添加zIndex: 2100，确保显示在详情弹窗之上
  - 修复需求详情页和Bug详情页的转换确认对话框被遮挡问题

- **修复Bug详情转需求弹窗被遮挡**
  - 为Bug详情页的转需求确认对话框添加zIndex: 2100
  - 确保确认对话框显示在详情弹窗之上

- **修复Bug指派界面问题**
  - 修复状态下拉框被遮挡问题
  - 修复指派给下拉框不显示成员的问题

#### 版本状态相关问题修复
- **修复版本状态显示错误**
  - 修复版本详情页和版本列表页的状态下拉菜单，使用正确的状态值（wait、normal、fail、terminate）
  - 修复Bug状态更新时创建新版本的状态错误（从draft改为wait）
  - 添加版本状态数据修复脚本（fix-version-status）用于修复数据库中已存在的draft状态

- **修复版本选择器表单验证问题**
  - 修复VersionSelectWithCreate组件的表单验证触发问题
  - 添加change事件确保表单验证正确触发
  - 修复新增Bug等界面选择版本后仍报警的问题

#### 配置和环境变量修复
- **修复DATABASE_DSN环境变量绑定问题**
  - 在config.go中添加环境变量显式绑定
  - 添加SetEnvKeyReplacer支持环境变量下划线到点号的转换
  - 确保DATABASE_DSN等环境变量能够正确读取
  - 支持Docker环境变量正确覆盖配置文件

### 功能增强 ✨

#### 工作报告功能优化
- **添加自动加载工作汇总功能**
  - 优化工作报告的用户体验
  - 自动加载工作汇总数据

#### Docker部署支持
- **添加Docker支持**
  - 创建Dockerfile和docker-compose.yml
  - 添加Docker启动脚本和Docker Compose安装脚本
  - 支持直接启动服务和安装Docker Compose V2
  - 简化部署流程

### 项目更新 📝

#### 品牌和文档更新
- **项目重命名**
  - 将项目名称从"项目管理系统"改为"项目流"（prjflow）
  - 添加项目logo
  - 更新项目文档和构建脚本

- **官网和演示数据**
  - 更新项目首页，优化统计数据展示
  - 添加GitHub统计数据获取功能
  - 添加演示数据生成工具，支持生成完整的演示数据库
  - 添加原始数据库文件demo.db

- **权限管理优化**
  - 修复权限代码命名，统一使用project-management

## 技术细节

### 代码变更
- **新增组件**
  - `frontend/src/components/VersionSelectWithCreate.vue` - 版本选择器组件

- **重构文件**
  - `frontend/src/views/bug/Bug.vue` - 使用新组件，清理重复代码
  - `frontend/src/views/bug/BugDetail.vue` - 使用新组件，清理重复代码
  - `frontend/src/views/requirement/Requirement.vue` - 修复弹窗遮挡问题
  - `frontend/src/views/version/Version.vue` - 修复状态下拉菜单
  - `frontend/src/views/version/VersionDetail.vue` - 修复状态下拉菜单

- **后端修复**
  - `backend/internal/api/bug.go` - 修复创建版本时状态错误
  - `backend/internal/config/config.go` - 修复环境变量绑定问题

- **新增工具**
  - `backend/cmd/fix-version-status/main.go` - 版本状态数据修复脚本

### 部署相关
- **新增文件**
  - `Dockerfile` - Docker镜像构建文件
  - `docker-compose.yml` - Docker Compose配置
  - `scripts/docker-start.sh` - Docker启动脚本
  - `scripts/install-docker-compose-v2.sh` - Docker Compose安装脚本

### 数据库变更
- 无数据库结构变更
- 添加演示数据库文件demo.db
- **数据修复**：如果数据库中存在状态为"draft"的版本，需要运行修复脚本：
  ```bash
  cd backend
  go run cmd/fix-version-status/main.go
  ```

### API变更
- 无破坏性API变更

## 升级说明

### 升级步骤
1. **更新代码**：拉取最新代码
2. **前端更新**：需要重新构建前端
   ```bash
   cd frontend
   npm run build
   ```
3. **后端更新**：需要重新编译后端
   ```bash
   cd backend
   go build -o server cmd/server/main.go
   ```

### Docker部署（新功能）
```bash
# 使用Docker Compose启动
docker-compose up -d

# 或使用启动脚本
./scripts/docker-start.sh
```

### 兼容性
- **向后兼容**：完全兼容 v0.5.6
- **API兼容**：所有API保持向后兼容
- **数据兼容**：无需数据迁移

### 注意事项
- 本次更新主要优化代码结构和修复UI问题，建议所有用户升级
- 新增Docker支持，推荐使用Docker部署的用户升级
- 代码重构优化，提高了代码可维护性
- **重要**：如果数据库中存在状态为"draft"的版本记录，需要运行数据修复脚本
- 环境变量绑定已修复，Docker部署时可以通过环境变量正确覆盖配置

## 统计信息

- **提交数量**：25个提交
- **主要功能**：
  - 代码重构优化（1项）
  - UI问题修复（6项）
  - 功能增强（2项）
  - 项目更新（5项）
  - 配置修复（1项）

### 代码改进
- **组件化**：提取版本选择器组件，减少100+行重复代码
- **UI修复**：修复6个弹窗遮挡和状态显示问题
- **部署优化**：添加Docker支持，简化部署流程
- **配置优化**：修复环境变量绑定，支持Docker环境变量覆盖

---

**版本号**: v0.5.7  
**发布日期**: 2025年12月21日  
**兼容性**: 向后兼容 v0.5.6  
**建议升级**: ✅ 是（代码优化和UI问题修复）


